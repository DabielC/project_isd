<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/face-api.min.js"></script>
    
    <title>input</title>
    <style>
        video {
            transform: scaleX(-1);
        }

        #video {
            display: block;
            margin: 0 auto;
            width: 100%;
            /* Full width of the SweetAlert modal */
            height: auto;
            max-width: 600px;
            /* Maximum width of the video */
        }

        #capture-btn {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: #3085d6;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            ;
        }
        .fade-in {
            opacity: 0; /* Start with the text hidden */
            animation: fadeIn 3s ease-out forwards; /* Apply the animation */
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0; /* Start with opacity 0 */
            }
            to {
                opacity: 1; /* End with opacity 1 */
            }
        }
        #Cam, #Upload {
            position: relative; 
        }
        #Cam {
            animation-name: move;
            animation-delay: 0ms;
            animation-duration: 2s;
        }

        @keyframes move {
            0% {
                left: -200px;
            }

            100% {
                left: 0px;
            }
        }

        #Upload {
            animation-name: move1;
            animation-delay: 0ms;
            animation-duration: 2s;
        }

        @keyframes move1 {
            0% {
                left: 200px;
            }

            100% {
                left: 0px;
            }
        }
    </style>
</head>

<body>
    <div class="flex h-screen bg-slate-950">
        <div class="flex flex-col items-center justify-center h-screen hidden md:block">
            <img src="glasses.jpg" class="h-full object-cover">
        </div>

        <div class="flex flex-col w-full lg:w-1/2 pl-10 lg:pl-20  bg-slate-950">
            <div class="text-white text-5xl md:text-5xl lg:text-7xl pt-10 lg:pt-15 pb-7">
                <h1 class="leading-relaxed fade-in">Unlock Your Perfect Frame</h1>
            </div>
    
            <!-- Open camera -->
            <div class="flex justify-center lg:justify-start items-center mx-4 mt-8" id="Cam">
                <button type="button"
                    class="w-full lg:w-2/3 text-gray-900 bg-white hover:bg-gray-100 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg px-8 py-4 text-center inline-flex items-center dark:focus:ring-gray-600 dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:hover:bg-gray-700 me-2 mb-5"
                    id="btn-start-camera" onclick="openCamera()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                        stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z" />
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z" />
                    </svg>
                    <span class="sm:text-sm  md:text-sm lg:text-lg ml-5">Open Camera</span>
                </button>
            </div>
    
            <!-- Upload file -->
            <div class="flex justify-center lg:justify-start items-center mx-4 mt-10" id="Upload">
                <label for="dropzone-file"
                    class="w-full lg:w-2/3 text-gray-900 bg-white hover:bg-gray-100 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg px-8 py-4 text-center inline-flex items-center dark:focus:ring-gray-600 dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:hover:bg-gray-700 me-2 mb-2 cursor-pointer">
                    <svg class="w-6 h-6 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
                    </svg>
                    <span class="sm:text-sm md:text-sm lg:text-lg ml-3">Click to upload</span>
                </label>
                <input id="dropzone-file" type="file" class="hidden" onchange="fileToImage(event)" />
            </div>
        </div>
    </div>

    <script>
        async function loadModels() {
            await faceapi.nets.tinyFaceDetector.loadFromUri('https://cdn.jsdelivr.net/npm/@vladmandic/face-api/model/');
        }
    
        async function openCamera() {
            Swal.fire({
                title: 'Access Your Camera',
                html: `
                    <video id="video" autoplay></video>
                    <button id="capture-btn">Capture Photo</button>
                    <canvas id="canvas" style="display:none;"></canvas>
                `,
                didOpen: async () => {
                    const video = document.querySelector('#video');
                    const canvas = document.querySelector('#canvas');
                    const captureBtn = document.querySelector('#capture-btn');
    
                    // Load face detection models
                    await loadModels();
    
                    // Access user's camera
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                        video.srcObject = stream;
                    } catch (err) {
                        Swal.fire('Error', 'Unable to access camera: ' + err.message, 'error');
                        return;
                    }
    
                    // Detect faces in real-time
                    video.addEventListener('play', async () => {
                        const displaySize = { width: video.videoWidth, height: video.videoHeight };
                        faceapi.matchDimensions(canvas, displaySize);
    
                        setInterval(async () => {
                            const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions());
                            if (detections.length > 0) {
                                const resizedDetections = faceapi.resizeResults(detections, displaySize);
                                faceapi.draw.drawDetections(canvas, resizedDetections);
                            }
                        }, 100);
                    });
    
                    // Capture photo when button is clicked
                    captureBtn.addEventListener('click', async () => {
                        const detections = await faceapi.detectSingleFace(video, new faceapi.TinyFaceDetectorOptions());
                        if (detections) {
                            const context = canvas.getContext('2d');
                            const { x, y, width, height } = detections.box;
    
                            // Set canvas size to 190x250
                            canvas.width = 190;
                            canvas.height = 250;
    
                            // Flip the captured image horizontally
                            context.translate(190, 0);
                            context.scale(-1, 1);
    
                            // Draw the image and resize it to 190x250
                            context.drawImage(video, x, y, width, height, 0, 0, 190, 250);
                            const imageUrl = canvas.toDataURL('image/png');
    
                            Swal.fire({
                                title: 'Captured Photo',
                                showDenyButton: true,
                                imageUrl: imageUrl,
                                imageAlt: 'Captured Photo',
                                confirmButtonText: 'OK',
                                denyButtonText: 'Retake',
                            }).then((result) => {
                                // Show Download
                                if (result.isConfirmed) {
                                    const link = document.createElement('a');
                                    link.href = imageUrl;
                                    link.download = 'image.jpg';
                                    link.click();
                                } else if (result.isDenied) {
                                    openCamera();
                                }
                            });
                        } else {
                            Swal.fire('Error', 'No face detected', 'error');
                        }
                    });
                },
                willClose: () => {
                    const video = document.querySelector('#video');
                    const stream = video.srcObject;
                    if (stream) {
                        const tracks = stream.getTracks();
                        tracks.forEach(track => track.stop());
                    }
                    video.srcObject = null;
                },
                showConfirmButton: false,
                width: '80vw',
            });
        }
    
        function fileToImage(event) {
            const input = event.target;
            const file = input.files[0];
    
            if (file) {
                const reader = new FileReader();
    
                reader.onload = function (e) {
                    const img = document.getElementById('display');
                    const imageUrl = e.target.result; // This is the data URL of the image
                    console.log(imageUrl);
                };
    
                reader.readAsDataURL(file);
            }
        }
    </script>
</body>

</html>